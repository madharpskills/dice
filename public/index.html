<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play dice</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/dice.css">
    <link rel="stylesheet" href="./css/sidebar.css">
</head>
<body>
    <div id="app">
        <div class="sidebar">
            <h1>Play a dice game</h1>
            <div class="player-section">
                <div class="player-item">
                    <div class="player-name">
                        <h3>Player One: </h3>
                        <label for="name">{{playerOne.name}}</label>
                        <div v-if="!renaming.playerOne" class="rename-player">
                            <button @click="renaming.playerOne = !renaming.playerOne">Rename</button>
                        </div>
                        <div v-if="renaming.playerOne">
                            <input v-model="playerOne.newName" type="text" name="name">
                            <button @click="renamePlayer('playerOne', playerOne.newName)">Submit</button>
                        </div>
                    </div>
                    <div class="score">
                        <h4>Score</h4>
                        <ul>
                            <li>Held: {{playerOne.heldScore}}</li>
                            <li>Round: {{playerOne.roundScore}}</li>
                            <li>Total: {{playerOne.totalScore}}</li>
                        </ul>
                    </div>
                </div>
                <div class="player-item">
                    <div class="player-name">
                        <h3>Player Two: </h3>
                        <label for="name">{{playerTwo.name}}</label>
                        <div v-if="!renaming.playerTwo" class="rename-player">
                            <button @click="renaming.playerTwo = !renaming.playerTwo">Rename</button>
                        </div>
                        <div v-if="renaming.playerTwo">
                            <input v-model="playerTwo.newName" type="text" name="name">
                            <button @click="renamePlayer('playerTwo', playerTwo.newName)">Submit</button>
                        </div>
                    </div>
                    <div class="score">
                        <h4>Score</h4>
                        <ul>
                            <li>Held: {{playerTwo.heldScore}}</li>
                            <li>Round: {{playerTwo.roundScore}}</li>
                            <li>Total: {{playerTwo.totalScore}}</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="help">
                <button @click="isHelpHidden = !isHelpHidden">Help</button>
                <div v-if="!isHelpHidden">
                    <h4>Rules:</h4>
                    <p>Each player gets 6 dice.</p>
                    <p>Roll all six, then choose dice to hold from that roll for points.
                    <p>Choose to roll again with remaining dice or pass turn.</p>
                    <p>If no dice in a roll yield points, then the turn is bust.</p>
                    <p>First player to earn 4000 points wins.</p>
                    <h4>Points system:</h4>
                    <p>1 is worth 100 points, 5 is worth 50</p>
                    <p>Three of a kind is worth that number x100 (i.e. three 2s is worth 200)</p>
                    <p>Three 1s are worth 1000 points</p>
                    <p>Four or more of a kind is worth double the points of three of a kind</p>
                    <p>Four 4s is worth 800, five 4s is 1600</p>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="turn-indicator">
                It's <b>{{turn.name}}'s</b> turn!
            </div>
            <div class="dice-area">
                <button v-for="die in dice" class="die" title="Hold" @click="hold(die)" id="die">{{die}}</button>
            </div>
            <div class="roll-button">
                <button @click="newRoll" class="roll">Roll</button>
            </div>
            <div v-if="true" class="hold">
                <h2>Held</h2>
                <button v-for="die in heldDice" class="die" title="Return" @click="returnDie(die)">{{die}}</button>
            </div>
            <div class="game-buttons">
                <button @click="">Score and roll again</button>
                <button @click="">Score and pass</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                isHelpHidden: true,
                tempusername: '',
                playerOne: { id: 1, name: 'Player One', newName: '', heldScore: 0, roundScore: 0, totalScore: 0, turn: true },
                playerTwo: { id: 2, name: 'Player Two', newName: '', heldScore: 0, roundScore: 0, totalScore: 0, turn: false },
                renaming: { playerOne: false, playerTwo: false },
                newName: '',
                turn: { player: 'playerOne', name: 'Player One'},
                dice: [1, 2, 3, 4, 5, 6],
                heldDice: []
            },
            methods: {
                newRoll() {
                    let rollResults = []
                    for (var i = 0; i < 6; i++) {
                        rollResults.push((Math.floor(Math.random() * 6) + 1))
                    }
                    this.dice = rollResults
                },
                renamePlayer(player, newName) {
                    this.renaming[player] = !this.renaming[player]
                    this[player].name = newName
                },
                hold(die) {
                    let heldDie = this.dice.find(targetDie => targetDie === die)
                    let rm = this.dice.findIndex(targetDie => targetDie === die)

                    this.heldDice.push(heldDie)
                    this.dice.splice(rm, 1)
                    this.calculateHeldScore(this.heldDice, this.turn.player)
                },
                returnDie(die) {
                    let returnDie = this.heldDice.find(targetDie => targetDie === die)
                    let rm = this.heldDice.findIndex(targetDie => targetDie === die)

                    this.heldDice.splice(rm, 1)
                    this.dice.push(returnDie)
                    this.calculateHeldScore(this.heldDice, this.turn.player)
                },
                calculateHeldScore(dice, player) {
                    let score = 0
                    let ones = dice.filter(die => die === 1)
                    let twos = dice.filter(die => die === 2)
                    let threes = dice.filter(die => die === 3)
                    let fours = dice.filter(die => die === 4)
                    let fives = dice.filter(die => die === 5)
                    let sixes = dice.filter(die => die === 6)

                    allDice = [ones, twos, threes, fours, fives, sixes]

                    for (set of allDice) {
                        if (set.length > 2) {
                            score += this.calculateScoreMultiples(set[0], set.length - 3)
                        }

                        if (set[0] === 1 && set.length < 3) {
                            for (die of set) {
                                score += 100
                            }
                        }

                        if (set[0] === 5 && set.length < 3) {
                            for (die of set) {
                                score += 50
                            }
                        }
                    }

                    this[player].heldScore = score
                },
                calculateScoreMultiples(dieValue, multiplier) {
                    if (dieValue === 1) {
                        dieValue = 10
                    }
                    let value = ((dieValue * 100) * 2 ** multiplier)
                    return value
                },
                endTurn() {
                    //add to total score
                    //check win condition
                }
            }
        })
    </script>
</body>
</html>